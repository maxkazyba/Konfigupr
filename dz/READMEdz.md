# –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä –º–∏–Ω–∏-DSL –Ω–∞ –±–∞–∑–µ Lark

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç –Ω–µ–±–æ–ª—å—à–æ–π –ø—Ä–µ–¥–º–µ—Ç–Ω–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —è–∑—ã–∫ (DSL) –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é –≥—Ä–∞–º–º–∞—Ç–∏–∫—É –∏ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä.
–ö–æ–¥ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç:

* –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≥—Ä–∞–º–º–∞—Ç–∏–∫–∏ –Ω–∞ Lark;
* –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–µ—Ä–µ–≤–∞ —Ä–∞–∑–±–æ—Ä–∞ —á–µ—Ä–µ–∑ Transformer;
* –ø–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–æ—Å—Ç—ã—Ö –∫–æ–Ω—Å—Ç–∞–Ω—Ç, —Å–ª–æ–≤–∞—Ä–µ–π, –ø—Ä–∏—Å–≤–∞–∏–≤–∞–Ω–∏–π;
* —Å—Å—ã–ª–∫–∏ –Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (`$[name]`);
* –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—é –ø–æ–ª—É—á–µ–Ω–Ω–æ–≥–æ AST;
* –≤—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON.

---

## üìå –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ DSL

–Ø–∑—ã–∫ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:

### 1. **–ß–∏—Å–ª–∞**

–õ—é–±—ã–µ —á–∏—Å–ª–∞ —Å –ø–ª–∞–≤–∞—é—â–µ–π —Ç–æ—á–∫–æ–π –∏–ª–∏ —Ü–µ–ª—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è.

```
5
50
-12.5
1.2e3
```

### 2. **–°–ª–æ–≤–∞—Ä–∏**

–°–ª–æ–≤–∞—Ä–∏ –æ–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ —Ñ–∏–≥—É—Ä–Ω—ã—Ö —Å–∫–æ–±–∫–∞—Ö, –ø–∞—Ä—ã ‚Äî —á–µ—Ä–µ–∑ `->`, –∑–∞–≤–µ—Ä—à–∞—é—Ç—Å—è —Ç–æ—á–∫–æ–π:

```
{
    A -> 10.
    B -> 20.
}
```

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å:

```
{
    B -> { Z -> 10. a -> 20. }.
}
```

### 3. **–ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã**

–°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã:

```
set a = 5
```

–ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –æ–∫—Ä—É–∂–µ–Ω–∏–∏ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä–∞ (`env`).

### 4. **–°—Å—ã–ª–∫–∏ –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏—è**

–ß—Ç–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ä–∞–Ω–µ–µ –æ–±—ä—è–≤–ª–µ–Ω–Ω–æ–π –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã:

```
$[a]
```

### 5. **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏**

–û–¥–Ω–æ—Å—Ç—Ä–æ—á–Ω—ã–µ:

```
# –≠—Ç–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
```

---

## üìå –ì—Ä–∞–º–º–∞—Ç–∏–∫–∞ —è–∑—ã–∫–∞

–ì—Ä–∞–º–º–∞—Ç–∏–∫–∞ –æ–ø–∏—Å–∞–Ω–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Lark:

```python
grammar = r""" 
start: value+

NUM: /-?(\d+|\d+\.\d*|\.\d+)([eE][-+]?\d+)?/
NAME: /[a-zA-Z][a-zA-Z0-9]*/

assign: NAME "->" value
reference: "$[" NAME "]"
const: "set" NAME "=" value
dict: "{" (assign".")+ "}"
value: NUM | dict | const | reference

%ignore /\s/  
%ignore /#[^\n]+/
"""
```

–ö–ª—é—á–µ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã:

* `assign` ‚Äî –ø–∞—Ä–∞ –∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ –≤–Ω—É—Ç—Ä–∏ —Å–ª–æ–≤–∞—Ä—è
* `const` ‚Äî –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
* `reference` ‚Äî —Å—Å—ã–ª–∫–∞ –Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
* `dict` ‚Äî —Å–ª–æ–≤–∞—Ä—å
* `value` ‚Äî —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç (—á–∏—Å–ª–æ, —Å–ª–æ–≤–∞—Ä—å, –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞, —Å—Å—ã–ª–∫–∞)

---

## üìå Transformer

–ö–ª–∞—Å—Å `T` –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —Å—ã—Ä–æ–π –ø–∞—Ä—Å–∏–Ω–≥ Lark –≤ —É–¥–æ–±–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É Python:

```python
class T(visitors.Transformer):
    NUM = float
    NAME = str
    ...
```

–§—É–Ω–∫—Ü–∏–∏:

* **NUM** ‚Üí `float`
* **dict** ‚Üí Python-—Å–ª–æ–≤–∞—Ä—å
* **reference** ‚Üí –∫–æ—Ä—Ç–µ–∂ –≤–∏–¥–∞ `("ref", name)`
* **const** ‚Üí –∫–æ—Ä—Ç–µ–∂ –≤–∏–¥–∞ `("const", (name, value))`

---

## üìå –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä

–§—É–Ω–∫—Ü–∏—è `interp(tree, env)` —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ –æ–±—Ö–æ–¥–∏—Ç—Å—è –ø–æ –¥–µ—Ä–µ–≤—É –∏:

* –≤—ã—á–∏—Å–ª—è–µ—Ç —á–∏—Å–ª–∞;
* —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç —Å–ª–æ–≤–∞—Ä–∏;
* –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤ `env`;
* –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è —Å—Å—ã–ª–æ–∫.

```python
env[name] = value
return env[name]
```

–í –∏—Ç–æ–≥–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤—ã—á–∏—Å–ª–µ–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç Python.

---

## üìå –ü—Ä–∏–º–µ—Ä –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

```text
 #–≠—Ç–æ –æ–¥–Ω–æ—Å—Ç—Ä–æ—á–Ω—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
5
50
set a = 5
{
    A -> 10.
    B -> { Z -> 10. a -> 20. r-> 30. e->$[a].}.
    C -> 5.
 }
set qq = 465
set tt = 555
```

---

## üìå –ü—Ä–∏–º–µ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

–ü–æ—Å–ª–µ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤—ã–≤–æ–¥–∏—Ç—Å—è –≤ –≤–∏–¥–µ JSON:

```json
[5.0, 50.0, ["a", 5.0], {
    "A": 10.0,
    "B": {
        "Z": 10.0,
        "a": 20.0,
        "r": 30.0,
        "e": 5.0
    },
    "C": 5.0
},
["qq", 465.0],
["tt", 555.0]]
```

---

## üìå –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

–¢—Ä–µ–±—É–µ—Ç—Å—è:

* **Python 3.8+**
* **Lark** (–¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞)

## üìå –ó–∞–ø—É—Å–∫

```bash
python dz.py
```

---

